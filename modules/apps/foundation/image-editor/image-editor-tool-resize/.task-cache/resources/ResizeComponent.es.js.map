{"version":3,"sources":["/source/ResizeComponent.es.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAaM;;;;;;;;;kCAIF,+BAAW;;;AACP,4BAAM,QAAN,CAAe,YAAM;AACjB,uBAAK,eAAL,GAAuB,IAAvB,CADiB;;AAGjB,uBAAK,WAAL,GAAmB,OAAK,cAAL,GAAsB,aAAtB,CAHF;AAIjB,uBAAK,UAAL,GAAkB,OAAK,cAAL,GAAsB,YAAtB,CAJD;;AAMjB,uBAAK,WAAL,GAAmB,OAAK,UAAL,GAAkB,OAAK,WAAL,CANpB;;AAQjB,uBAAK,iBAAL,GAAyB,OAAK,OAAL,CAAa,aAAb,CAA2B,MAAM,OAAK,GAAL,GAAW,QAAjB,CAApD,CARiB;AASjB,uBAAK,gBAAL,GAAwB,OAAK,OAAL,CAAa,aAAb,CAA2B,MAAM,OAAK,GAAL,GAAW,OAAjB,CAAnD,CATiB;aAAN,CAAf,CADO;;;AAJT,kCAyBF,2BAAQ,WAAW;AACf,gBAAI,YAAY,SAAS,aAAT,CAAuB,QAAvB,CAAZ,CADW;AAEf,sBAAU,KAAV,GAAkB,UAAU,GAAV,CAAc,KAAd,CAFH;AAGf,sBAAU,MAAV,GAAmB,UAAU,GAAV,CAAc,MAAd,CAHJ;;AAKf,sBAAU,UAAV,CAAqB,IAArB,EAA2B,YAA3B,CAAwC,UAAU,GAAV,EAAe,CAAvD,EAA0D,CAA1D,EALe;;AAOf,gBAAI,SAAS,SAAS,aAAT,CAAuB,QAAvB,CAAT,CAPW;AAQf,mBAAO,KAAP,GAAe,KAAK,UAAL,CARA;AASf,mBAAO,MAAP,GAAgB,KAAK,WAAL,CATD;;AAWf,mBAAO,UAAP,CAAkB,IAAlB,EAAwB,SAAxB,CAAkC,SAAlC,EAA6C,CAA7C,EAAgD,CAAhD,EAAmD,KAAK,UAAL,EAAiB,KAAK,WAAL,CAApE,CAXe;;AAaf,mBAAO,4BAAmB,OAAnB,CAA2B,OAAO,SAAP,EAA3B,CAAP,CAbe;;;AAzBjB,kCA8CF,yCAAe,OAAO;AAClB,gBAAI,KAAK,eAAL,EAAsB;AACtB,oBAAI,WAAW,MAAM,cAAN,CAAqB,KAArB,CADO;;AAGtB,oBAAI,MAAM,cAAN,KAAyB,KAAK,gBAAL,EAAuB;AAChD,yBAAK,WAAL,GAAmB,WAAW,KAAK,WAAL,CADkB;AAEhD,yBAAK,UAAL,GAAkB,QAAlB,CAFgD;;AAIhD,yBAAK,iBAAL,CAAuB,KAAvB,GAA+B,KAAK,WAAL,CAJiB;iBAApD,MAKO;AACH,yBAAK,WAAL,GAAmB,QAAnB,CADG;AAEH,yBAAK,UAAL,GAAkB,WAAW,KAAK,WAAL,CAF1B;;AAIH,yBAAK,gBAAL,CAAsB,KAAtB,GAA8B,KAAK,UAAL,CAJ3B;iBALP;aAHJ;;;AA/CF,kCAoEF,uDAAsB,OAAO;AACzB,iBAAK,eAAL,GAAuB,CAAC,KAAK,eAAL,CADC;;;eApE3B;;;;;;;;AA8EN,oBAAgB,KAAhB,GAAwB;;;;;AAKpB,wBAAgB;AACZ,uBAAW,eAAK,UAAL;SADf;KALJ;;;AAWA,kBAAI,QAAJ,CAAa,eAAb;;sBAEe","sourcesContent":["import Component from 'metal-component/src/Component';\nimport Soy from 'metal-soy/src/Soy';\n\nimport async from 'metal/src/async/async';\nimport core from 'metal/src/core';\nimport { CancellablePromise } from 'metal-promise/src/promise/Promise';\n\nimport componentTemplates from './ResizeComponent.soy';\nimport controlsTemplates from './ResizeControls.soy';\n\n/**\n * Resize Component\n */\nclass ResizeComponent extends Component {\n    /**\n     * @inheritDoc\n     */\n    attached() {\n        async.nextTick(() =>Â {\n            this.lockProportions = true;\n\n            this.imageHeight = this.getEditorImage().naturalHeight;\n            this.imageWidth = this.getEditorImage().naturalWidth;\n\n            this.imageRatio_ = this.imageWidth / this.imageHeight;\n\n            this.imageHeightInput_ = this.element.querySelector('#' + this.key + 'Height');\n            this.imageWidthInput_ = this.element.querySelector('#' + this.key + 'Width');\n        });\n    }\n\n    /**\n     * Executes the resize operation to get the final version of the image.\n     *\n     * @param  {Object} imageData An object with several image representations.\n     * @return {CancellablePromise} A promise that will resolve when the webworker\n     * finishes processing the image for preview.\n     */\n    process(imageData) {\n        let rawCanvas = document.createElement('canvas');\n        rawCanvas.width = imageData.raw.width;\n        rawCanvas.height = imageData.raw.height;\n\n        rawCanvas.getContext('2d').putImageData(imageData.raw, 0, 0);\n\n        let canvas = document.createElement('canvas');\n        canvas.width = this.imageWidth;\n        canvas.height = this.imageHeight;\n\n        canvas.getContext('2d').drawImage(rawCanvas, 0, 0, this.imageWidth, this.imageHeight);\n\n        return CancellablePromise.resolve(canvas.toDataURL());\n    }\n\n    /**\n     * [syncDimensions description]\n     * @param  {[type]} event [description]\n     * @return {[type]}       [description]\n     */\n    syncDimensions(event) {\n        if (this.lockProportions) {\n            let newValue = event.delegateTarget.value;\n\n            if (event.delegateTarget === this.imageWidthInput_) {\n                this.imageHeight = newValue / this.imageRatio_;\n                this.imageWidth = newValue;\n\n                this.imageHeightInput_.value = this.imageHeight;\n            } else {\n                this.imageHeight = newValue;\n                this.imageWidth = newValue * this.imageRatio_;\n\n                this.imageWidthInput_.value = this.imageWidth;\n            }\n        }\n    }\n\n    /**\n     * [toggleLockProportions description]\n     * @return {[type]} [description]\n     */\n    toggleLockProportions(event) {\n        this.lockProportions = !this.lockProportions;\n    }\n}\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nResizeComponent.STATE = {\n    /**\n     * Injected helper to get the editor image\n     * @type {Function}\n     */\n    getEditorImage: {\n        validator: core.isFunction\n    }\n};\n\n// Register component\nSoy.register(ResizeComponent, componentTemplates);\n\nexport default ResizeComponent;"]}